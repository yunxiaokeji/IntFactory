@{
    var isRoot = (@ViewBag.Status!=8 && @ViewBag.Mark == 3 && @ViewBag.FinishStatus > 0 && Model.Status < 6 && Model.PurchaseStatus == 0);
 }

@{if (string.IsNullOrEmpty(ExpandClass.IsLimits(HttpContext.Current, "109010106"))){
<div id="navProducts" class="nav-partdiv hide">
    <table class="table-list mTop20">
        <tr class="tr-header">
            <td class="tLeft">材料名称</td>
            <td class="tLeft">编码</td>
            <td class="tLeft">规格</td>
            <td class="width80">单位</td>
            <td >单价</td>
            <td class="">消耗量</td>
            <td class="">损耗量</td>
            <td class="tRight">小计</td>
        </tr>

        @{
            foreach (var detail in Model.Details)
            { 
                <tr class="item cart-item" data-autoid="@(detail.AutoID)" data-id="@(detail.ProductDetailID)" >
                    <td><a href="/Products/ChooseDetail?pid=@(detail.ProductID)&did=@(detail.ProductDetailID)" target="_blank">@(detail.ProductName)</a></td>
                        <td>@(detail.ProductCode)</td>
                    <td>@(detail.Remark)</td>
                    <td class="center">@(detail.UnitName)</td>
                                
             @{                  
                if (isRoot && string.IsNullOrEmpty(ExpandClass.IsLimits(HttpContext.Current, "109010101")) )
                {
                    <td class="center tr-price"><input  type="text" data-id="@(detail.AutoID)" data-name="@(detail.ProductName)" data-value="@(detail.Price.ToString("f2"))" class="price width50" value="@(detail.Price.ToString("f2"))" /></td>
                    <td class="center tr-quantity">@(detail.Quantity.ToString("f3"))</td>
                    <td class="center tr-loss"><input  type="text" data-id="@(detail.AutoID)" data-name="@(detail.ProductName)" data-value="@(detail.Loss.ToString("f3"))" class="loss width50" value="@(detail.Loss.ToString("f3"))" /></td>
                }
                else
                {
                    <td class="tr-price center"><label class="price">@(detail.Price.ToString("f2"))</label></td>
                    <td class="center tr-quantity">@(detail.Quantity.ToString("f3"))</td>
                    <td class="center tr-loss">@(detail.Loss.ToString("f3"))</td>
                                         
                }
                        <td class="tRight amount">@((detail.TotalMoney).ToString("f3"))</td>   
                }
              </tr>
            }
        }

        <tr class="amount-item">
            <td colspan="6"></td>
            <td class="tRight">成本合计：</td>
            <td class="tRight"><label id="amount"></label></td>
                        
        </tr>
    </table>

    @{
      if (isRoot)
        {
            if (string.IsNullOrEmpty(ExpandClass.IsLimits(HttpContext.Current, "109010104")))
            {
            <a href="javascript:void(0);"  id="btnEffectiveOrderProduct" class="btn right mTop10 ">生成采购单</a>
            }
            if (string.IsNullOrEmpty(ExpandClass.IsLimits(HttpContext.Current, "109010101")))
            {
            <a href="/Orders/ChooseMaterial?id=@(Model.OrderID)&tid=@(ViewBag.TaskID)"  id="btn-addMaterial" class="btn right mTop10 mRight10">添加材料</a>
            }


        }
    }
    <div class="clear"></div>
</div>
}}
