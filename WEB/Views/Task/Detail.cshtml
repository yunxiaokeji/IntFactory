@{
    ViewBag.Title = "Detail";
    var model = (IntFactoryEntity.Task.TaskEntity)ViewBag.Model;
    var order = (IntFactoryEntity.OrderEntity)ViewBag.Order;
}
<link href="/modules/css/task/style.css" rel="stylesheet" />
@section scripts{
    <script src="/modules/plug/laydate/laydate.js"></script>
    <script type="text/javascript">
        $(function () {
            seajs.use(["scripts/task/detail"], function (obj) {
                obj.init('@(model.TaskID)', '@(model.StageID)', '@(model.OrderID)','@(model.Mark)');
            });
        });
    </script>
}
<div class="taskContent" id="taskDetailContent" data-taskid="@(model.TaskID)">
    <div class="taskOperate">
        <div class="left">
            <div class="left"><img title="到期日期" style="width:30px;" src="/modules/images/ico-endtime.png" /></div>
            <div class="left mLeft10"><input type="text" style="width:80px;" id="@(model.FinishStatus==2?"":"UpdateTaskEndTime")" value="@(model.EndTime.ToString()=="0001-1-1 0:00:00"?"未指定日期":model.EndTime.ToString("yyyy-MM-dd"))" placeholder="设置到期日期"/></div>
            <div class="clear"></div>
            
        </div>
        <div class="right mRight10">
            @{
                if(model.FinishStatus!=2)
                {
                    <input type="button" class="btn" id="FinishTask" value="标记完成"/>
                }
                else
                {
                    <span class="taskFinishStatus">已完成</span>
                }
             }
        </div>
        <div class="clear"></div>
    </div>
    
    <div class="taskDetail">
        
        <ul class="left">
            <li>
                <span class="column-title">任务内容:</span>
                <span>@(model.Title)</span>
            </li>
             <li>
                <span class="column-title">负责人:</span>
                <span>@(model.Owner.Name)</span>
            </li>
              <li>
                <span class="column-title">订单编号:</span>
                <a href="/Customer/OrderDetail/@(model.OrderID)" target="_blank">@(model.OrderCode)</a>
            </li>
           
        </ul>
        <div class="right"> <img class="right width100" onerror="$(this).attr('src','/modules/images/img-noimg.png')" src="@( string.IsNullOrEmpty(model.OrderImg)?"/modules/images/img-noimg.png":model.OrderImg)"/></div>
        <div class="clear"></div>

        
    </div>

    <div id="navRemark" class=" talk-body nav-partdiv">
        @{
          if(model.Mark==1)
          {
        <div class="talk-title">物料列表</div>

        <div id="navProducts" class="nav-partdiv">
                <table class="table-list mTop20">
                    <tr class="tr-header">
                        <td class="tLeft">材料名称</td>
                        <td class="tLeft">规格</td>
                        <td class="width80">单位</td>
                        <td class="tLeft">单价</td>
                        <td class="">消耗量</td>
                        <td class="">损耗量</td>
                        <td class="tRight">小计</td>
                        <td class="">删除</td>
                    </tr>
                    @foreach (var detail in order.Details)
                    { 
                        <tr class="item cart-item" data-autoid="@(detail.AutoID)" data-id="@(detail.ProductDetailID)" >
                            <td><a href="/Products/ChooseDetail?pid=@(detail.ProductID)&did=@(detail.ProductDetailID)" target="_blank">@(detail.ProductName)</a></td>
                            <td>@(detail.Remark)</td>
                            <td class="center">@(detail.UnitName)</td>
                            <td class="tr-price"><label class="price">@(detail.Price.ToString("f2"))</label></td>
                            <td class="center tr-quantity"><input  type="text" data-id="@(detail.AutoID)" data-name="@(detail.ProductName)" data-value="@(detail.Quantity.ToString("f2"))" class="quantity width50" value="@(detail.Quantity.ToString("f2"))" /></td>
                            <td class="center tr-loss"><input  type="text" data-id="@(detail.AutoID)" data-name="@(detail.ProductName)" data-value="@(detail.Loss.ToString("f2"))" class="loss width50" value="@(detail.Loss.ToString("f2"))" /></td>
                            <td class="tRight amount">@((detail.TotalMoney).ToString("f2"))</td>
                            <td class="center">
                                <a class="ico-del" href="javascript:void(0)" title="删除" data-name="@(detail.ProductName)" data-id="@(detail.AutoID)"></a>
                            </td>
                        </tr>
                    }
                    <tr class="amount-item">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td class="tRight">成本合计：</td>
                        <td class="tRight"><label id="amount"></label></td>
                        <td></td>
                    </tr>
                </table>
                <a href="/Customer/ChooseProducts/@(model.OrderID)" class="btn right mTop10">添加材料</a>
                <div class="clear"></div>
            </div>
        }
        }

        @{
          if(model.Mark==2)
          {
        <div class="talk-title mTop10">制版信息</div>

        <div class="platemakingContent">
            <table class="table-list mTop10">
                <tr class="tr-header">
                    <td class="width150 tLeft">行操作</td>
                    <td class="width50 tLeft" data-columnname="columnname1">
                        <span class="tbContent">列名1</span>
                        <input class="hide tbContentIpt" value="列名1" type="text"/>
                        <span class="ico-dropdown mLeft10" data-columnname="columnname1"></span>
                    </td>
                    <td class="width150 tLeft" data-columnname="columnname2">
                        <span class="tbContent">列名2</span>
                        <input class="hide tbContentIpt" value="列名2" type="text"/>
                        <span class="ico-dropdown mLeft10" data-columnname="columnname2"></span>
                    </td>
                </tr>
                <tr>
                    <td class="width150 tLeft">
                        <span class="btn-addRow btn">添加</span>
                        <span class="mLeft10 btn-removeRow btn">删除</span>
                    </td>
                    <td class="width50 tLeft" data-columnname="columnname1">
                        <span class="tbContent">无内容</span>
                        <input class="hide tbContentIpt" value="无内容" type="text"/>
                    </td>
                    <td class="width150 tLeft" data-columnname="columnname2">
                        <span class="tbContent">无内容</span>
                        <input class="hide tbContentIpt" value="无内容" type="text"/>
                    </td>
                </tr>
            </table>
        </div>
        }
        }

        <div class="content-main mTop30">
            <textarea id="txtContent" class="txt-content" placeholder="发表评论"></textarea><br />
            <div class="btn right mTop5" id="btnSaveTalk">提交</div>
            <div class="clear"></div>
        </div>

        <div class="talk-title"> 全部讨论</div>

        <table class="content-list" id="replyList"></table>

        <div id="pagerReply" class="mTop10"></div>

        <ul class="dropdown-ul hide"  style="width:90px;">
            <li id="btn-addColumn">添加新列</li>
            <li id="btn-removeColumn">删除此列</li>
        </ul>
    </div>
</div>